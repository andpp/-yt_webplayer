var APMPlayerFactory;void 0===APMPlayerFactory&&(APMPlayerFactory=function(){"use strict";function a(){}var i={type:{AUDIO:"audio",LIVE_AUDIO:"live_audio"},isValid:function(e){var t;for(t in i.type)if(i.type[t]===e)return!0;return!1}};a.enabled=!1,a.consoleOnly=!0,a.log=function(e,t,n){!1!==a.enabled&&("undefined"!=typeof soundManager?(void 0===n&&(n="APMPlayer"),soundManager._writeDebug(n+"::"+e,t.id,!1)):console.log(n+"::"+e+"["+t.name+"]"))},a.type={info:{id:1,name:"info"},warn:{id:2,name:"warning"},error:{id:3,name:"error"}};function t(){this.type={AUDIO_LIB_READY:"AUDIO_LIB_READY",MEDIA_READY:"MEDIA_READY",PLAYER_READY:"PLAYER_READY",PLAYER_FAILURE:"PLAYER_FAILURE",CONNECTION_LOST:"CONNECTION_LOST",MISSING_FILE:"MISSING_FILE",PLAYLIST_CURRENT_CHANGE:"PLAYLIST_CURRENT_CHANGE",POSITION_UPDATE:"POSITION_UPDATE",PLAYING:"PLAYING",PAUSED:"PAUSED",FINISHED:"FINISHED",UNLOADED:"UNLOADED",BUFFER_START:"BUFFER_START",BUFFER_END:"BUFFER_END",METADATA:"METADATA",VOLUME_UPDATED:"VOLUME_UPDATED"},this.handlers=[]}t.prototype={trigger:function(e,t){for(var n=0;n<this.handlers.length;n+=1)this.handlers[n].eventName===e&&this.handlers[n].eventHandler.call(this,t)},addListener:function(e,t){"string"==typeof e&&"function"==typeof t||a.log("Invalid parameters when creating listener with the following arguments: 'Name': "+e+", 'Handler': "+t,a.type.error),this.handlers.push({eventName:e,eventHandler:t})},removeListeners:function(){this.handlers=[]}};function s(){this.type={PLAYING:"PLAYING",STOPPED:"STOPPED",PAUSED:"PAUSED"},this._current=this.type.STOPPED}s.prototype={current:function(){return this._current},set:function(e,t){this._current=e,"object"==typeof t&&t.hasOwnProperty("state")&&(t.state=this._current)}};function r(){this.type={FLASH:"FLASH",HTML5:"HTML5"},this.solutions=[this.type.FLASH,this.type.HTML5]}r.prototype={getCurrentSolution:function(){return 0<this.solutions.length?this.solutions[0]:null},removeCurrentSolution:function(){return 0<this.solutions.length?(this.solutions.shift(),!0):(a.log("PlaybackMechanism.removeCurrentSolution() no playback solutions remain to remove!",a.type.error),!1)},setSolutions:function(e){if(e instanceof Array){for(var t,n=[];0<e.length;)t=e.shift(),this.isValid(t)?n.push(t):a.log("PlaybackMechanism.setSolutions() passed mechanism '"+t+"' is invalid.",a.type.error);return this.solutions=n,!0}return a.log("PlaybackMechanism.setSolutions() argument passed is not an array!",a.type.error),!1},isValid:function(e){var t;for(t in this.type)if(this.type[t]===e)return!0;return!1}};function e(){this.schemes=[],this.scheme_map={},this.playable_attrs=[]}e.prototype={init:function(e){this.scheme_map=e,this.initSchemeTypes(),this.initPlayableAttrs()},initSchemeTypes:function(){for(var e in this.schemes=[],this.scheme_map)this.schemes.push(e)},initPlayableAttrs:function(){this.playable_attrs=[];var e=new l({});for(var t in e)"function"!=typeof e[t]&&this.playable_attrs.push(t)},hasSchemes:function(){return 0<this.schemes.length},isValid:function(e){return-1!==this.schemes.indexOf(e)},isScheme:function(e,t){var n=this.parse(e);return null!==n&&n.scheme===t},parse:function(e){var t="^("+this.schemes.join("|")+"){1}(:/){1}([/\\w .-]+$)",n=new RegExp(t),i=e.match(n);return null!==i&&4===i.length?{scheme:i[1],path:i[3]}:null},getValues:function(e){var t={},n=this.parse(e);if(null!==n&&this.isValid(n.scheme)){var i=this.scheme_map[n.scheme];for(var a in i.hasOwnProperty(n.path)&&(i=i[n.path]),i)-1!==this.playable_attrs.indexOf(a)?t[a]=i[a]:"flash_file_prefix"===a?t.flash_file_path=i[a]+"/"+n.path:"http_file_prefix"===a&&(t.http_file_path=i[a]+"/"+n.path)}return t}};var o=new e,l=function(e){var t,n=this;if(this.identifier=null,this.type=null,this.flash_file_path="",this.flash_server_url="",this.http_file_path="",this.buffer_time=3,this.downloadable=!0,this.title="",this.description="",this.detail="",this.date="",this.program="",this.host="",this.image_sm="",this.image_lg="",this.duration=0,this.position=0,this.percent_played=0,this.percent_loaded=0,this.state="STOPPED",void 0===e.identifier||null===e.identifier||""===e.identifier)return n;n.setMembers(e),o.hasSchemes()&&(t=o.getValues(n.identifier),n.setMembers(t))};l.prototype={isValid:function(){return!(null===this.identifier||null===this.type||!i.isValid(this.type))},isCustomScheme:function(e){return!0===o.isScheme(this.identifier,e)},isEOF:function(){return.99995<this.percent_played},reset:function(){this.position=0,this.percent_played=0,this.percent_loaded=0},setEmptyMembers:function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.hasOwnProperty(t)&&null!==e[t]&&""!==e[t]&&(null===this[t]||""===this[t]||0===this[t])&&(this[t]=e[t])},setMembers:function(e){for(var t in e)e.hasOwnProperty(t)&&this.hasOwnProperty(t)&&(this[t]=e[t])},clearFlashProperties:function(){this.flash_server_url="",this.flash_file_path=""},isFlashStreamable:function(){return""!==this.flash_server_url&&""!==this.flash_file_path}};function n(){function e(){this.lib=soundManager,this.init_status=!1}var n=this;return e.prototype={init:function(){!1===n.audio.init_status?(this.lib.flashVersion=9,this.lib.preferFlash=!0,this.lib.useHTML5Audio=!0,this.lib.consoleOnly=a.consoleOnly,this.lib.debugMode=a.enabled,this.lib.flashPollingInterval=150,this.lib.url=n.util.getLoadedScriptPathByFileName("soundmanager2")+"swf/",this.lib.onready(function(){!0===n.audio.lib.html5Only&&(n.mechanism.setSolutions([n.mechanism.type.HTML5]),a.log("Audio.init() -- setting to HTML5-only",a.type.info)),a.log("Audio.init() success",a.type.info),n.audio.init_status=!0,n.internal_events.trigger(n.events.type.AUDIO_LIB_READY,{})}),this.lib.ontimeout(function(e){n.audio.lib.canPlayMIME("audio/mp3")||n.audio.lib.canPlayMIME("audio/mpeg")?n.mechanism.setSolutions([n.mechanism.type.HTML5]):n.mechanism.setSolutions([]),n.audio.reset()})):(n.audio.reset(),a.log("Audio.init() -- audio lib has already been initialized once, attempting reset",a.type.info))},reset:function(){switch(n.audio.init_status=!1,n.mechanism.getCurrentSolution()){case n.mechanism.type.FLASH:n.audio.lib.preferFlash=!0,n.audio.lib.html5Only=!1;break;case n.mechanism.type.HTML5:n.audio.lib.preferFlash=!1,n.audio.lib.html5Only=!0;break;default:return a.log("Audio.reset() no playback solution exists.",a.type.error),n.events.trigger(n.events.type.PLAYER_FAILURE,null),!1}n.audio.lib.reboot()},load:function(e){if(!0===this.init_status)try{var t;switch(n.mechanism.getCurrentSolution()){case n.mechanism.type.FLASH:t={id:e.identifier,url:e.http_file_path,bufferTime:e.buffer_time,onconnect:function(){a.log("Audio.load.lib.createSound.onConnect() - successfully connected over RTMP ("+e.flash_server_url+")",a.type.info),n.internal_events.trigger(n.events.type.MEDIA_READY,e)},onfailure:function(e){var t=n.current_playable;0<t.position?(a.log("Audio.load.createSound.onfailure() -- network connection has been lost",a.type.info),n.state.set(n.state.type.STOPPED,t),n.events.trigger(n.events.type.CONNECTION_LOST,t)):!0===e.connected?(a.log("Audio.load.createSound.onfailure() - requested file '"+t.flash_file_path+"' w/ identifier '"+t.identifier+"' could not be found in flash/RTMP mode.",a.type.error),n.state.set(n.state.type.STOPPED,t),n.events.trigger(n.events.type.MISSING_FILE,t),n.events.trigger(n.events.type.FINISHED,t)):(a.log("Audio.load.createSound.onfailure() - could not connect to '"+t.flash_server_url+"' ... falling back to HTML5-mode.",a.type.error),n.state.set(n.state.type.STOPPED,t),n.mechanism.removeCurrentSolution(),n.audio.reset())},onload:function(e){var t;!1===e&&(t=n.current_playable,n.events.trigger(n.events.type.MISSING_FILE,t),a.log("Audio.load.createSound.onload() - could not load '"+t.http_file_path+"' over progressive download",a.type.error))}},null!==e.flash_file_path&&""!==e.flash_file_path&&null!==e.flash_server_url&&""!==e.flash_server_url&&(t.serverURL=e.flash_server_url,t.url=e.flash_file_path),this.lib.createSound(t);break;case n.mechanism.type.HTML5:t=this.lib.createSound({id:e.identifier,url:e.http_file_path,onload:function(e){var t=n.current_playable;e?this.duration?(t.duration=this.duration,a.log("Audio.load.createSound.onload(): duration found after start",a.type.info)):a.log("Audio.load.createSound.onload(): duration unknown",a.type.info):(n.state.set(n.state.type.STOPPED,t),n.events.trigger(n.events.type.MISSING_FILE,t),n.events.trigger(n.events.type.FINISHED,t),a.log("Audio.load.createSound.onload():  requested file '"+t.http_file_path+"' w/ identifier '"+t.identifier+"' could not be found in HTML5 mode.",a.type.error))}}),n.internal_events.trigger(n.events.type.MEDIA_READY,e);break;default:a.log("Audio.load() no playback solution exists.",a.type.error),n.events.trigger(n.events.type.PLAYER_FAILURE,e)}}catch(e){a.log("Exception thrown in APMPlayer.Audio.load : "+e.toString(),a.type.error)}else null===n.mechanism.getCurrentSolution()?n.events.trigger(n.events.type.PLAYER_FAILURE,e):a.log("Audio.lib.load - audio lib not initialized.  load() will be called again when player is finally initialized.",a.type.info)},unload:function(e){null!==n.current_playable&&(a.log("Audio.unload() about to stop, drop and roll current sound.",a.type.info),this.lib.destroySound(e.identifier),e.reset(),n.state.set(n.state.type.STOPPED,e),n.events.trigger(n.events.type.UNLOADED,e))},play:function(e){this.lib.getSoundById(e.identifier)?(a.log("Audio.play() attempting to play from lib.",a.type.info),this.lib.play(e.identifier,{volume:100*n.settings.volume,position:e.position,onplay:function(){n.state.set(n.state.type.PLAYING,e),n.events.trigger(n.events.type.PLAYING,e),n.events.trigger(n.events.type.METADATA,e),n.settings.muted&&this.mute(),a.log("Audio.play.onplay() PLAYING fired",a.type.info)},onpause:function(){n.state.set(n.state.type.PAUSED,e),n.events.trigger(n.events.type.PAUSED,e),a.log("Audio.play.onpause() PAUSED fired",a.type.info)},onresume:function(){n.state.set(n.state.type.PLAYING,e),n.events.trigger(n.events.type.PLAYING,e),a.log("Audio.play.onresume() PLAYING fired",a.type.info)},onfinish:function(){n.current_playable.reset(),n.state.set(n.state.type.STOPPED,e),n.events.trigger(n.events.type.FINISHED,e),a.log("Audio.play.onfinish() FINISHED fired; playable reset.",a.type.info)},onbufferchange:function(){!0===this.isBuffering?(n.events.trigger(n.events.type.BUFFER_START,e),a.log("Audio.play.onbufferchange() BUFFER_START fired ",a.type.info)):(n.events.trigger(n.events.type.BUFFER_END,e),a.log("Audio.play.onbufferchange() BUFFER_END fired ",a.type.info))},whileplaying:function(){var e=n.current_playable;e.type===i.type.LIVE_AUDIO?(e.percent_played=g_percent_played,e.duration=g_duration,e.position=g_position,n.events.trigger(n.events.type.POSITION_UPDATE,e)):(0!==this.position&&(e.position=this.position),0!==this.duration&&this.duration>e.duration&&(e.duration=this.duration),this.durationEstimate>this.duration?e.percent_loaded=this.duration/this.durationEstimate:0<e.percent_loaded&&e.percent_loaded<1&&(e.percent_loaded=1),0<e.duration&&(e.percent_played=e.position/e.duration),e.isEOF()?(e.percent_played=1,e.position=e.duration):n.events.trigger(n.events.type.POSITION_UPDATE,e))},onmetadata:function(){this.hasOwnProperty("metadata")&&(this.metadata.hasOwnProperty("adw_ad")&&"true"===this.metadata.adw_ad&&this.metadata.hasOwnProperty("metadata")&&-1!==this.metadata.metadata.indexOf("adswizzContext")?(a.log("onmetadata() received adw_ad of insertionType: '"+this.metadata.insertionType+"'",a.type.info),e.title="adw_ad_"+this.metadata.insertionType,e.adw_context=this.metadata.metadata.substr(15),n.events.trigger(n.events.type.METADATA,e)):this.metadata.hasOwnProperty("StreamTitle")&&void 0!==this.metadata.StreamTitle&&(a.log("onmetadata() received metadata w/ title: '"+this.metadata.StreamTitle+"'",a.type.info),e.title=this.metadata.StreamTitle,n.events.trigger(n.events.type.METADATA,e)))}})):this.load(e)},pause:function(e){var t=this.lib.getSoundById(e.identifier);return t?(t.pause(),!0):(a.log("Audio.pause() Error.  Could not pause.  '"+e.identifier+"' is unknown.",a.type.warn),!1)},unpause:function(e){var t=this.lib.getSoundById(e.identifier);return t&&!0===t.paused?(t.resume(),!0):(a.log("Audio.unpause() Error.  Could not unpause.  '"+e.identifier+"' is unknown.",a.type.warn),!1)},seek:function(e,t){var n=this.lib.getSoundById(e.identifier);if(n){if(e.duration){a.log("Audio.seek() seeking to '"+t+"' of sound '"+e.identifier+"'",a.type.info);var i=t*e.duration;return n.setPosition(i),!0}return a.log("Audio.seek() Error.  Could not seek. duration of '"+e.identifier+"' is unknown.",a.type.warn),!1}return a.log("Audio.seek() sound '"+e.identifier+"' is unknown.",a.type.warn),!1},mute:function(e){var t=this.lib.getSoundById(e.identifier);t&&t.mute()},unmute:function(e){var t=this.lib.getSoundById(e.identifier);t&&t.unmute()},setVolume:function(e,t){var n=100*t,i=this.lib.getSoundById(e.identifier);i?(a.log("Audio.setVolume() setting volume to "+n+"% (out of 100)",a.type.info),i.setVolume(n)):a.log("Audio.setVolume() sound is not loaded.  volume will be set to "+n+"% once audio begins playing",a.type.info)}},this.settings={volume:.9,muted:!1,debug:!1},this.current_playable=null,this.events=new t,this.internal_events=new t,this.mechanism=new r,this.state=new s,this.audio=new e,this.internal_event_handlers={checkReady:function(){!0===n.audio.init_status?(a.log("checkReady() player ready.  all dependencies loaded.",a.type.info),n.events.trigger(n.events.type.PLAYER_READY,{})):a.log("checkReady() not quite ready -- waiting for other dependencies to load...",a.type.info)},onMediaReady:function(e){n.audio.play(e)}},this.internal_events.addListener(n.events.type.AUDIO_LIB_READY,n.internal_event_handlers.checkReady),this.internal_events.addListener(n.events.type.MEDIA_READY,n.internal_event_handlers.onMediaReady),this.util={getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},getLoadedScriptPathByFileName:function(e){for(var t=document.getElementsByTagName("script"),n=t.length,i=0;i<n;i+=1){var a=t[i].src.indexOf(e,0);if(-1!==a)return t[i].src.slice(0,a)}},getProjectBasePath:function(){var e=n.util.getLoadedScriptPathByFileName("script/apmplayer-all.min.js");return void 0===e&&(e=n.util.getLoadedScriptPathByFileName("script/apmplayer.js")),e},mergeSettings:function(e){var t;for(t in e)e.hasOwnProperty(t)&&n.settings.hasOwnProperty(t)&&(n.settings[t]=e[t])},checkDebug:function(){n.util.getParameterByName("debug")&&(a.enabled=!0),"all"===n.util.getParameterByName("debug")&&(a.consoleOnly=!1)},addIEFixes:function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;for((n=n<0?Math.ceil(n):Math.floor(n))<0&&(n+=t);n<t;n++)if(n in this&&this[n]===e)return n;return-1})}},{init:function(){n.util.addIEFixes(),n.util.checkDebug(),n.audio.init()},reset:function(e){e instanceof Array&&n.mechanism.setSolutions(e),n.audio.reset()},play:function(e,t){if(!(e instanceof l))return a.log("play() invalid playable passed.  must of of type Playable.  did nothing.",a.type.error),!1;if(e===n.current_playable&&n.state.current()!==n.state.type.PLAYING)switch(e.type){case i.type.AUDIO:case i.type.LIVE_AUDIO:n.audio.play(e);break;case i.type.VIDEO:break;default:a.log("play() unsupported type: '"+e.type+"'",a.type.error)}else if(e!==n.current_playable){if(null===n.mechanism.getCurrentSolution())return a.log("play()  insufficient playback mechanism for platform.  Triggered PLAYER_FAILURE",a.type.error),n.events.trigger(n.events.type.PLAYER_FAILURE,e),!1;switch(null!==n.current_playable&&n.audio.unload(n.current_playable),n.util.mergeSettings(t),(n.current_playable=e).type){case i.type.AUDIO:case i.type.LIVE_AUDIO:n.audio.load(e);break;case i.type.VIDEO:break;default:a.log("load() unsupported type: '"+e.type+"'",a.type.error)}}},pause:function(){var e=n.current_playable;if(null!==e)switch(e.type){case i.type.AUDIO:n.audio.pause(e);break;case i.type.LIVE_AUDIO:n.audio.unload(e);break;case i.type.VIDEO:break;default:a.log("pause() unsupported type: '"+e.type+"'",a.type.error)}else a.log("pause() no current playable loaded.  nothing to pause.",a.type.warn)},unload:function(){var e=n.current_playable;if(null!==e)switch(e.type){case i.type.AUDIO:case i.type.LIVE_AUDIO:n.audio.unload(e);break;case i.type.VIDEO:break;default:a.log("unload() unsupported type: '"+e.type+"'",a.type.error)}else a.log("unload() no current playable loaded.  nothing to stop/unload.",a.type.info)},seek:function(e){var t=n.current_playable;if(null!==t)switch(t.type){case i.type.AUDIO:n.audio.seek(t,e);break;case i.type.LIVE_AUDIO:g_seek(e);break;case i.type.VIDEO:break;default:a.log("seek() unsupported type: '"+t.type+"'",a.type.error)}else a.log("seek() no current playable loaded.  nothing to seek.",a.type.info)},mute:function(){n.settings.muted=!0;var e=n.current_playable;if(null!==e)switch(e.type){case i.type.AUDIO:case i.type.LIVE_AUDIO:n.audio.mute(e);break;case i.type.VIDEO:break;default:a.log("mute() unsupported type: '"+e.type+"'",a.type.error)}a.log("mute() -- player is now muted.",a.type.info)},unmute:function(){n.settings.muted=!1;var e=n.current_playable;if(null!==e)switch(e.type){case i.type.AUDIO:case i.type.LIVE_AUDIO:n.audio.unmute(e);break;case i.type.VIDEO:break;default:a.log("unmute() unsupported type: '"+e.type+"'",a.type.error)}a.log("unmute() -- player is now unmuted.",a.type.info)},setVolume:function(e){e<0?a.log("setVolume() invalid percent_decimal passed: '"+(e=0)+"' is less than 0.  percent_decimal set to 0.  percentages must be represented as a decimal from 0 to 1 (eg .45)",a.type.warn):1<e&&a.log("setVolume() invalid percent_decimal passed: '"+(e=1)+"' is greater than 1.  percent_decimal set to 1.00 by default.  percentages must be represented as a decimal from 0.00 to 1.00 (eg .45)",a.type.warn);var t=n.current_playable;if(null!==t)switch(t.type){case i.type.AUDIO:case i.type.LIVE_AUDIO:n.audio.setVolume(t,e);break;case i.type.VIDEO:break;default:a.log("setVolume() unsupported type: '"+t.type+"'",a.type.error)}else a.log("setVolume() no playable loaded.  VOLUME_UPDATED event still fired. new vox : '"+e+"'",a.type.info);n.settings.volume=e,n.events.trigger(n.events.type.VOLUME_UPDATED,{percent_decimal:e})},debug:a,events:n.events,mechanism:n.mechanism,mediaTypes:i.type,state:n.state,base_path:n.util.getProjectBasePath()}}function u(){this.events=new t,this._items=[],this._current_index=null}var p;return u.prototype={add:function(e){return e instanceof l&&e.isValid()?null!==this.item(e.identifier)?(a.log("add() could not add '"+e.identifier+"' to playlist because it already exists!",a.type.warn,"Playlist"),!1):(this._items.push(e),null===this._current_index&&(this._current_index=0,this.events.trigger(this.events.type.PLAYLIST_CURRENT_CHANGE,null)),a.log("add() new playable successfully added to playlist: '"+e.identifier+"'",a.type.info,"Playlist"),!0):(a.log("add() -- error: nothing added to playlist.  either object passed was not of type Playable or identifier '"+e.identifier+"' is invalid.",a.type.warn,"Playlist"),!1)},_count:function(){return this._items.length},current:function(){return null!==this._current_index?this._items[this._current_index]:null},item:function(e){for(var t=this._count(),n=0;n<t;n+=1)if(this._items[n].identifier===e)return this._items[n];return null},goto:function(e){for(var t=this._count(),n=0;n<t;n+=1)if(this._items[n].identifier===e){var i=this.current();return this._current_index=n,this.events.trigger(this.events.type.PLAYLIST_CURRENT_CHANGE,i),!0}return a.log("goto() - invalid identifier passed '"+e+"'.  This was not found in the current playlist!",a.type.warn,"Playlist"),!1},hasNext:function(){return this._current_index+1<this._count()},remove:function(e){for(var t=this._count(),n=0;n<t;n+=1)if(this._items[n].identifier===e)return this.current().identifier===e?(a.log("remove() -- sorry, you may not remove the current item in the playlist. returning false.)",a.type.warn,"Playlist"),!1):(this._items.splice(n,1),0<this._current_index&&n<=this._current_index&&--this._current_index,!0);return!1},next:function(){if(null===this._current_index)return!1;a.log("next() advancing to next position in playlist (or to beginning if at last)",a.type.info,"Playlist");var e=this.current();this._current_index=this._current_index+1<this._count()?this._current_index+1:0,this.events.trigger(this.events.type.PLAYLIST_CURRENT_CHANGE,e)},previous:function(){if(null===this._current_index)return!1;a.log("previous() moving to previous position in playlist (or to last if at beginning)",a.type.info,"Playlist");var e=this.current();this._current_index=0<=this._current_index-1?this._current_index-1:this._count()-1,this.events.trigger(this.events.type.PLAYLIST_CURRENT_CHANGE,e)}},{getPlayer:function(){return void 0===p&&((p=new n).constructor=null),p},getPlayable:function(e){return new l(e)},getPlaylist:function(){return new u},getCustomSchemes:function(){return o}}}());var scheme_map={apm_audio:{flash_server_url:"rtmp://archivemedia.publicradio.org/music",flash_file_prefix:"mp3:ondemand",http_file_prefix:"http://ondemand.publicradio.org",buffer_time:3,type:"audio"},apm_live_audio:{mpr_news:{flash_server_url:"rtmp://wowza.stream.publicradio.org/news",flash_file_path:"news.stream",http_file_path:"http://nis.stream.publicradio.org/nis.mp3",buffer_time:6,type:"live_audio"},mpr_current:{flash_server_url:"rtmp://wowza.stream.publicradio.org/kcmp",flash_file_path:"kcmp.stream",http_file_path:"http://current.stream.publicradio.org/kcmp.mp3",buffer_time:6,type:"live_audio"}}},custom_schemes=APMPlayerFactory.getCustomSchemes();custom_schemes.init(scheme_map);var APMPlayer=APMPlayerFactory.getPlayer();APMPlayer.init(),function(a){"use strict";function n(e,t){var i=this;this.parent_id="#"+e.attr("id"),this.args=t,this.init=function(){i.main.init(),i.controls.init(),i.events.init(),i.playlist.init()},this.main={settings:{autoplay:!1,muted:!1,fetchMetadata:!1,volume:.9},isReady:!1,init:function(){i.args.hasOwnProperty("settings")&&i.main.mergeSettings(i.args.settings),!0===i.main.settings.autoplay&&!0===i.main.settings.fetchMetadata&&(i.main.settings.autoplay="wait")},mergeSettings:function(e){var t;for(t in e)e.hasOwnProperty(t)&&i.main.settings.hasOwnProperty(t)&&(i.main.settings[t]=e[t])},canAutoPlay:function(){return!0===i.main.settings.autoplay&&APMPlayer.mechanism.getCurrentSolution()!==APMPlayer.mechanism.type.HTML5&&!0===i.main.isReady},updateAutoPlay:function(e){i.playlist.current().identifier===e.identifier&&"wait"===i.main.settings.autoplay&&(i.main.settings.autoplay=!0)},fetchMetadata:function(e){i.events.onFetchMetadata(e)}},this.skin={css:{play:"apm_player_play",pause:"apm_player_pause",seeker:"apm_player_bar",seekerBufferingCls:"buffering",seekerLoading:"apm_player_loading",liveStreamingCls:"streaming",volumeWrapper:"apm_player_volume_wrapper",volumeMutedCls:"muted",volumeBar:"apm_volume_bar",volumeBarWrapper:"apm_player_volume_slider_wrapper",volumeStatus:"apm_player_volume_status",info:"apm_player_info",status:"apm_player_status",statusWarningCls:"warning",statusAlertCls:"alert",playtime:"apm_player_playtime",playlist:"apm_playlist",playlistNowPlayingCls:"nowplaying",sponsorOverlayActiveCls:"preroll-active",sponsorOverlayInactiveCls:"preroll-inactive",sponsorTimer:"apm_sponsor_overlay_time",sharingTools:"apm_sharing_tools",sharingTabControls:"apm_sharing_tab_controls",sharingTabCls:"apm_sharing_tab",sharingTabSharing:"apm_sharing_share",sharingTabDownload:"apm_sharing_download",sharingTabEmbed:"apm_sharing_embed",sharingTabLink:"apm_sharing_link"}},this.controls={init:function(){i.controls.seeker.init(),i.controls.info.init(),i.controls.volume.init(),i.controls.volumeStatus.init(),i.controls.pause.init(),i.controls.play.init(),i.controls.tools.init()},play:{init:function(){a(i.parent_id+" #"+i.skin.css.play).click(function(){APMPlayer.play(i.playlist.current(),i.main.settings)})}},pause:{init:function(){a(i.parent_id+" #"+i.skin.css.pause).click(function(){APMPlayer.pause()})}},seeker:{status:"NORMAL",init:function(){a(i.parent_id+" #"+i.skin.css.seeker).slider({disabled:!0,range:"min",start:function(e,t){i.controls.seeker.status="USER_SLIDING"},stop:function(e,t){i.events.onSeek(t.value/100),i.controls.seeker.status="NORMAL"},slide:function(e,t){i.controls.seeker.status="USER_SLIDING";var n=i.playlist.current();n.position=t.value/100*n.duration,i.controls.playtime.render(n)}})},update:function(e){var t,n;"NORMAL"===i.controls.seeker.status&&(t=100*e.percent_played,a(i.parent_id+" #"+i.skin.css.seeker).slider("value",t)),e.percent_loaded<=1&&(n=100*e.percent_loaded,a(i.parent_id+" #"+i.skin.css.seekerLoading).width(n+"%"))},enable:function(){a(i.parent_id+" #"+i.skin.css.seeker).slider("enable")},disable:function(){a(i.parent_id+" #"+i.skin.css.seeker).slider("disable")},reset:function(){a(i.parent_id+" #"+i.skin.css.seeker).slider("value",0)},configure:function(e){i.controls.seeker.reset(),0<e.duration&&i.controls.seeker.enable(),a(i.parent_id+" #"+i.skin.css.seeker).removeClass(i.skin.css.liveStreamingCls)}},playtime:{convertToTime:function(e){var t=new Date(e),n=t.getUTCHours(),i=t.getUTCMinutes(),a=t.getUTCSeconds();return(0<n?n+":":"")+(0<n&&i<10?"0"+i:i)+":"+(a<10?"0"+a:a)},render:function(e){var t=0<e.duration?i.controls.playtime.convertToTime(e.position)+" / "+i.controls.playtime.convertToTime(e.duration):i.controls.playtime.convertToTime(e.position);a(i.parent_id+" #"+i.skin.css.playtime).text(t)}},volume:{init:function(){a(i.parent_id+" #"+i.skin.css.volumeBar).slider({range:"min",orientation:"vertical",value:100*i.main.settings.volume,stop:function(e,t){APMPlayer.setVolume(t.value/100),0<t.value&&i.main.settings.muted&&(APMPlayer.unmute(),i.controls.volumeStatus.renderUnmuted(),i.main.settings.muted=!1)}}),a(i.parent_id+" #"+i.skin.css.volumeWrapper).hover(function(){a(i.parent_id+" #"+i.skin.css.volumeBarWrapper).show()},function(){a(i.parent_id+" #"+i.skin.css.volumeBarWrapper).fadeOut(500)})},renderMuted:function(){a(i.parent_id+" #"+i.skin.css.volumeBar).slider("value",0)},renderUnmuted:function(){a(i.parent_id+" #"+i.skin.css.volumeBar).slider("value",100*i.main.settings.volume)}},volumeStatus:{init:function(){a(i.parent_id+" #"+i.skin.css.volumeStatus).click(function(){i.main.settings.muted?(APMPlayer.unmute(),i.main.settings.muted=!1,i.controls.volume.renderUnmuted(),i.controls.volumeStatus.renderUnmuted()):(APMPlayer.mute(),i.main.settings.muted=!0,i.controls.volume.renderMuted(),i.controls.volumeStatus.renderMuted())})},renderMuted:function(){a(i.parent_id+" #"+i.skin.css.volumeStatus).addClass(i.skin.css.volumeMutedCls)},renderUnmuted:function(){a(i.parent_id+" #"+i.skin.css.volumeStatus).removeClass(i.skin.css.volumeMutedCls)}},info:{init:function(){i.args.hasOwnProperty("onMetadata")&&(i.events.onMetadata=i.args.onMetadata)}},status:{displayWarning:function(e){a(i.parent_id+" #"+i.skin.css.status).html(e),a(i.parent_id+" #"+i.skin.css.status).addClass(i.skin.css.statusWarningCls)},displayAlert:function(e){a(i.parent_id+" #"+i.skin.css.status).html(e),a(i.parent_id+" #"+i.skin.css.status).addClass(i.skin.css.statusAlertCls)},clearAll:function(){a(i.parent_id+" #"+i.skin.css.status).removeClass(i.skin.css.statusAlertCls),a(i.parent_id+" #"+i.skin.css.status).removeClass(i.skin.css.statusWarningCls),a(i.parent_id+" #"+i.skin.css.status).html("")}},tools:{init:function(){i.args.hasOwnProperty("tools")&&i.args.tools.hasOwnProperty("config")&&(i.controls.tools.config=i.args.tools.config),i.controls.tools.config()},config:function(){a(i.parent_id+" #"+i.skin.css.sharingTools+" ."+i.skin.css.sharingTabCls).hide(),a(i.parent_id+" #"+i.skin.css.sharingTools+" ."+i.skin.css.sharingTabCls+":first").show(),a(i.parent_id+" #"+i.skin.css.sharingTools+" ul#"+i.skin.css.sharingTabControls+" li:first").addClass("active"),a(i.parent_id+" #"+i.skin.css.sharingTools+" ul#"+i.skin.css.sharingTabControls+" li a").click(function(){a(i.parent_id+" #"+i.skin.css.sharingTools+" ul#"+i.skin.css.sharingTabControls+" li").removeClass("active"),a(this).parent().addClass("active");var e=a(this).attr("href");return a(i.parent_id+" #"+i.skin.css.sharingTools+" ."+i.skin.css.sharingTabCls).hide(),a(e).show(),!1})},renderDownload:function(e){var t="",t=!0===e.downloadable&&i.playlist.current().type===APMPlayer.mediaTypes.AUDIO?'<a href="'+APMPlayer.base_path+"util/download.php?uri="+e.http_file_path+'">file download</a>':"sorry, this item is not downloadable.";a(i.parent_id+" #"+i.skin.css.sharingTools+" #"+i.skin.css.sharingTabDownload).html(t)}}},this.events={init:function(){APMPlayer.events.addListener(APMPlayer.events.type.PLAYER_READY,i.events.onPlayerReady),APMPlayer.events.addListener(APMPlayer.events.type.PLAYING,i.events.onPlaying),APMPlayer.events.addListener(APMPlayer.events.type.PAUSED,i.events.onPaused),APMPlayer.events.addListener(APMPlayer.events.type.METADATA,i.events.onMetadata),APMPlayer.events.addListener(APMPlayer.events.type.BUFFER_START,i.events.onBufferStart),APMPlayer.events.addListener(APMPlayer.events.type.BUFFER_END,i.events.onBufferEnd),APMPlayer.events.addListener(APMPlayer.events.type.POSITION_UPDATE,i.events.onPositionUpdate),APMPlayer.events.addListener(APMPlayer.events.type.FINISHED,i.events.onFinished),APMPlayer.events.addListener(APMPlayer.events.type.UNLOADED,i.events.onUnloaded),APMPlayer.events.addListener(APMPlayer.events.type.VOLUME_UPDATED,i.events.onVolumeUpdated),APMPlayer.events.addListener(APMPlayer.events.type.CONNECTION_LOST,i.events.onConnectionLost),APMPlayer.events.addListener(APMPlayer.events.type.PLAYER_FAILURE,i.events.onFailure),APMPlayer.events.addListener(APMPlayer.events.type.MISSING_FILE,i.events.onMissingFile)},onPlayerReady:function(){var e;i.main.isReady=!0,i.main.canAutoPlay()?APMPlayer.play(i.playlist.current(),i.main.settings):null!==(e=i.playlist.current())&&i.events.onMetadata(e)},onPlaying:function(e){i.controls.seeker.enable(),i.controls.status.clearAll(),a(i.parent_id+" #"+i.skin.css.play).hide(),a(i.parent_id+" #"+i.skin.css.pause).show(),i.playlist.addNowPlaying(e)},onPaused:function(e){a(i.parent_id+" #"+i.skin.css.play).show(),a(i.parent_id+" #"+i.skin.css.pause).hide(),e.type===APMPlayer.mediaTypes.LIVE_AUDIO&&i.controls.seeker.reset()},onFinished:function(){APMPlayer.unload()},onPositionUpdate:function(e){i.controls.seeker.update(e),"USER_SLIDING"!==i.controls.seeker.status&&i.controls.playtime.render(e)},onSeek:function(e){var t;APMPlayer.state.current()!==APMPlayer.state.type.STOPPED?APMPlayer.seek(e):0<(t=i.playlist.current()).duration&&(t.percent_played=e,t.position=t.duration*e,i.controls.playtime.render(t))},onUnloaded:function(e){i.controls.seeker.reset(),i.controls.playtime.render(e),a(i.parent_id+" #"+i.skin.css.play).show(),a(i.parent_id+" #"+i.skin.css.pause).hide()},onBufferStart:function(){APMPlayer.state.current()===APMPlayer.state.type.PLAYING&&a(i.parent_id+" #"+i.skin.css.seeker).addClass(i.skin.css.seekerBufferingCls)},onBufferEnd:function(){a(i.parent_id+" #"+i.skin.css.seeker).removeClass(i.skin.css.seekerBufferingCls)},onFetchMetadata:function(e){APMPlayer.debug.log("events.onFetchMetadata() pass-through hit for  '"+e.identifier+"'",APMPlayer.debug.type.info,"APMPlayerUI");var t=i.playlist.current();e.identifier===t.identifier&&(i.events.onMetadata(t),i.controls.tools.renderDownload(t),0<t.duration&&(i.controls.playtime.render(t),t.isFlashStreamable()&&(i.controls.seeker.enable(),0<t.position&&(t.percent_played=t.position/t.duration),i.controls.seeker.update(t))),i.main.updateAutoPlay(t),i.main.canAutoPlay()&&APMPlayer.play(i.playlist.current(),i.main.settings))},onMetadata:function(){},onFailure:function(){var e=i.playlist.current(),t='<p>We\'re sorry, but your browser is not able to play the stream.  Please try one of these options:  <br /><br />1) Install or enable <a href="http://get.adobe.com/flashplayer/" target="_blank">Adobe Flash Player</a> <br />2) Use a browser that supports HTML5 and MP3 audio, such as <a href="http://www.google.com/chrome/" target="_blank">Chrome</a>, <a href="http://www.apple.com/safari/download/" target="_blank">Safari</a>, or <a href="http://www.microsoft.com/ie9" target="_blank">Internet Explorer 9</a>';/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&(t='<p>We\'re sorry, but your browser is not able to play the stream.  Please try one of these options:  <br /><br />1) Install or enable <a href="http://get.adobe.com/flashplayer/" target="_blank">Adobe Flash Player</a> <br />2) Install <a href="http://www.apple.com/quicktime/download/" target="_blank">Quicktime</a> for HTML5 support for Safari on Windows (requires reboot) <br />2b) Use a different browser that natively supports HTML5 and MP3 audio, such as <a href="http://www.google.com/chrome/" target="_blank">Chrome</a> or <a href="http://www.microsoft.com/ie9" target="_blank">Internet Explorer 9</a>'),!0===e.downloadable&&""!==e.http_file_path&&(e.type===APMPlayer.mediaTypes.AUDIO?t+='<br />3) <a href="'+APMPlayer.base_path+"util/download.php?uri="+e.http_file_path+'">download the audio</a>':e.type===APMPlayer.mediaTypes.LIVE_AUDIO&&(t+='<br />3) <a href="'+e.http_file_path+'">Stream the audio using a third-party player (eg. iTunes)</a>')),t+="</p>",i.controls.status.displayWarning(t)},onVolumeUpdated:function(e){i.main.settings.volume=e.percent_decimal},onConnectionLost:function(){APMPlayer.unload();i.controls.status.displayAlert("<p>Your network connection has changed or has been lost.<br /><br />Please check your connection, then click play to resume.")},onMissingFile:function(e){i.controls.status.displayWarning("<p>We're sorry, an error has occurred and your audio cannot be played at this time. <br /><br />Often, this error is a result of a poor or missing internet connection.  Please check your internet connection, then click play to resume.")}},this.playlist=APMPlayerFactory.getPlaylist(),i.playlist.onUpdate=function(e){},i.playlist.init=function(){i.args.hasOwnProperty("onPlaylistUpdate")&&(i.playlist.onUpdate=i.args.onPlaylistUpdate),i.args.hasOwnProperty("playables")&&a.each(i.args.playables,function(e,t){i.playlist.addPlayable(t)})},i.playlist.addPlayable=function(e){var t=APMPlayerFactory.getPlayable(e);t.isValid()?(i.playlist.add(t),i.playlist.onUpdate(t),!0===i.main.settings.fetchMetadata&&(t.isCustomScheme("apm_audio")?i.main.fetchMetadata(t):i.main.updateAutoPlay(t))):APMPlayer.debug.log("sorry, there was a problem with the parameters passed and a valid playable could not be created.",APMPlayer.debug.type.warn,"APMPlayerUI")},i.playlist.gotoItem=function(e){APMPlayer.state.current()!==APMPlayer.state.type.STOPPED&&i.playlist.current().identifier===e||(i.controls.seeker.disable(),i.playlist.goto(e))},i.playlist.addNowPlaying=function(e){a("li[ id = '"+e.identifier+"']").addClass(i.skin.css.playlistNowPlayingCls)},i.playlist.removeNowPlaying=function(e){a(i.parent_id+" #"+i.skin.css.playlist+" li[ id = '"+e.identifier+"']").removeClass(i.skin.css.playlistNowPlayingCls)},i.playlist.onCurrentChange=function(e){null!==e&&(i.playlist.removeNowPlaying(e),APMPlayer.play(i.playlist.current(),i.main.settings));var t=i.playlist.current();i.controls.seeker.configure(t),i.controls.tools.renderDownload(t),0<t.duration&&i.controls.playtime.render(t)},i.playlist.events.addListener(APMPlayer.events.type.PLAYLIST_CURRENT_CHANGE,i.playlist.onCurrentChange),i.init()}a.fn.apmplayer_ui=function(e){if(void 0===APMPlayer||"undefined"==typeof soundManager)return a.error("apmplayer_ui ERROR.  1 or more dependent libraries missing.  exiting."),null;var t={addPlayable:function(e){void 0!==window.apmplayer_ui?window.apmplayer_ui.playlist.addPlayable(e):APMPlayer.debug.log("you must first initialize apmplayer_ui before calling methods on it.",APMPlayer.debug.type.error,"APMPlayerUI")},gotoPlaylistItem:function(e){void 0!==window.apmplayer_ui?window.apmplayer_ui.playlist.gotoItem(e):APMPlayer.debug.log("you must first initialize apmplayer_ui before calling methods on it.",APMPlayer.debug.type.error,"APMPlayerUI")}};if(t[e])return t[e].apply(this,Array.prototype.slice.call(arguments,1));"object"!=typeof e&&e?APMPlayer.debug.log("Method "+e+" does not exist on jQuery.apmplayer_ui",APMPlayer.debug.type.error,"APMPlayerUI"):void 0===window.apmplayer_ui?(window.apmplayer_ui=new n(this,e),APMPlayer.debug.log("instantiated apmplayer_ui",APMPlayer.debug.type.info,"APMPlayerUI")):APMPlayer.debug.log("sorry, only one player UI instance is currently supported.",APMPlayer.debug.type.error,"APMPlayerUI")}}(jQuery);